
@{
    ViewBag.Title = "Map";
}

<style>
    #map {
        width: 100%;
        height: 400px;
        background-color: grey;
    }

    .gm-style-iw {
        width: 350px !important;
        top: 15px !important;
        left: 0px !important;
        background-color: #fff;
        box-shadow: 0 1px 6px rgba(178, 178, 178, 0.6);
        border: 1px solid rgba(72, 181, 233, 0.6);
        border-radius: 2px 2px 10px 10px;
    }

    #iw-container {
        margin-bottom: 10px;
    }

        #iw-container .iw-title {
            font-family: 'Open Sans Condensed', sans-serif;
            font-size: 22px;
            font-weight: 400;
            padding: 10px;
            background-color: #48b5e9;
            color: white;
            margin: 0;
            border-radius: 2px 2px 0 0;
        }

        #iw-container .iw-content {
            font-size: 13px;
            line-height: 18px;
            font-weight: 400;
            margin-right: 1px;
            padding: 15px 5px 20px 15px;
            max-height: 140px;
            overflow-y: auto;
            overflow-x: hidden;
        }

    .iw-content img {
        float: right;
        margin: 0 5px 5px 10px;
    }

    .iw-subTitle {
        font-size: 16px;
        font-weight: 700;
        padding: 5px 0;
    }

    .iw-bottom-gradient {
        position: absolute;
        width: 326px;
        height: 25px;
        bottom: 10px;
        right: 18px;
        background: linear-gradient(to bottom, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
        background: -webkit-linear-gradient(top, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
        background: -moz-linear-gradient(top, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
        background: -ms-linear-gradient(top, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 100%);
    }
</style>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDIANXZR7wMkoTZfgwe8bHqrUKbbrkdDg&callback=initMap&libraries=places"
        type="text/javascript"></script>
<div id="map"></div>
@section Scripts {

    <script type="text/javascript">

        var request;
        var service;
        let btn;
        var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        var labelIndex = 0;
        let markers = [];
        var apikey = 'AIzaSyDDIANXZR7wMkoTZfgwe8bHqrUKbbrkdDg';
        var details = 'https://maps.googleapis.com/maps/api/place/details/json?placeid=';


        function initialize() {
           
            var mapOptions = {
                zoom: 14,
                center: new google.maps.LatLng(37.975533, 23.735101),
                mapTypeId: google.maps.MapTypeId.ROADMAP,
            };
            map = new google.maps.Map(document.getElementById('map'),
                mapOptions);
             
            // Adds a marker to the map.
            function addMarker(location, map) {
                // Add the marker at the clicked location, and add the next-available label
                // from the array of alphabetical characters.
                 let marker = new google.maps.Marker({
                    position: location,
                    label: labels[labelIndex++ % labels.length],
                    map: map
                });
            }
            geocoder = new google.maps.Geocoder; 
            google.maps.event.addListener(map, 'click', function (e) {
                btn = document.createElement("BUTTON");
                geocoder.geocode({
                    'location': e.latLng
                }, function (results, status) {
                    if (status === google.maps.GeocoderStatus.OK) {
                        if (results[0]) {

                            request = {
                                place_id: results[0].place_id,
                                address: results[0].formatted_address,
                            };
                            console.log(request);
                            // alert(request);
                        } else {
                            console.log('No results found');
                        }
                    } else {
                        console.log('Geocoder failed due to: ' + status);
                    }
                    if (!document.getElementsByClassName('poi-info-window gm-style')[0].contains(document.getElementById('review'))) {
                        document.getElementsByClassName('poi-info-window gm-style')[0].appendChild(btn);
                        btn.innerHTML = "Review";
                        btn.setAttribute("id", "review")
                        btn.onclick = function () { addMarker(e.latLng, map) }
                        map.data.add(new google.maps.Data.Feature({properties:{},geometry:new google.maps.Data.Point(location)})); 

                        function saveMarker() {
                            map.data.toGeoJson(function (json) {
                            localStorage.setItem('geoData', JSON.stringify(json));
                            });
                        }
                    }
                });
            });
        }



        google.maps.event.addDomListener(window, 'load', initialize);

    </script>

}

