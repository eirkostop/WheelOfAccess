<style>
    /* Set the size of the div element that contains the map */
    #map {
        height: 400px; /* The height is 400 pixels */
        width: 100%; /* The width is the width of the web page */
    }
</style>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDIANXZR7wMkoTZfgwe8bHqrUKbbrkdDg&callback=initMap&libraries=places">
</script>

<div id="map"> </div>

@section Scripts{
    <script type="text/javascript">
        var request;
        var service;
        let btn;
        var labels = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        var labelIndex = 0;
        let markers = [];
        var apikey = 'AIzaSyDDIANXZR7wMkoTZfgwe8bHqrUKbbrkdDg';
        var details = 'https://maps.googleapis.com/maps/api/place/details/json?placeid=';


        function initialize() {
            function addPlace(request) {
                let name = $("#review").siblings().children('.title').html()
              
                
                $.ajax({
                    method: "PUT",
                    url: "/Rest/Place",
                    data: {
                        Address: request.address,
                        Name: name,
                        GoogleId: request.place_id
                    },
                    success: function (response) {
                        console.log("success-place");
                    }
                })
            }
            function addReview(googleId) {
                $.ajax({
                    method: "PUT",
                    url: "/Rest/Review",
                    data: { googleId: googleId },
                    success: function (response) {
                        console.log(response);
                        window.location.assign("/Reviews/Edit/" + response);
                        console.log("success-review");

                    }
                })
            }
            let mapOptions = {
                zoom: 14,
                center: new google.maps.LatLng(37.975533, 23.735101),
                mapTypeId: google.maps.MapTypeId.ROADMAP,
            }
            function addMarker(location, map) {
                var marker = new google.maps.Marker({
                    position: location,
                    label: labels[labelIndex++ % labels.length],
                    map: map
                });
            }
            function addReviewButton(e) {
                geocoder.geocode({ 'location': e.latLng }, function (results, status) {
                    if (status === google.maps.GeocoderStatus.OK) {
                        if (results[0]) {
                            request = {
                                position: results[0].geometry.location,
                                place_id: results[0].place_id,
                                address: results[0].formatted_address
                            };
                        } else {
                            console.log('No results found');
                        }
                    } else {
                        console.log('Geocoder failed due to: ' + status);
                    }
                    btn = document.createElement("BUTTON");
                    if (!document.getElementsByClassName('poi-info-window gm-style')[0].contains(document.getElementById('review'))) {
                    document.getElementsByClassName('poi-info-window gm-style')[0].appendChild(btn);
                    btn.innerHTML = "Review";
                    btn.setAttribute("id", "review")
                        btn.onclick = function () {
                            addMarker(e.latLng, map);
                            addPlace(request);
                            addReview(request.place_id)
                        }
                    }
                });
            }

            map = new google.maps.Map(document.getElementById('map'),mapOptions);
            geocoder = new google.maps.Geocoder;
            google.maps.event.addListener(map, 'click', function (e) {addReviewButton(e)});
        }
        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
}